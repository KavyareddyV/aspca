<!-- sldsValidatorIgnore -->
<template>
    <header class="slds-modal__header">
        <h2 class="slds-modal__title slds-hyphenate">
            New Session:
        </h2>
    </header>
    <div class="slds-modal__content slds-var-p-around_medium">
        
        <lightning-record-edit-form object-api-name="Treatment_Session__c"
                                        onsubmit={handleSubmit}
                                        onsuccess={handleSuccess}>
            <template if:true={hasPlan}>
                <div class="slds-grid slds-wrap"> 
                    <div class="slds-col slds-size_1-of-2"> 
                        <label class="slds-form-element__label" for="form-element-01">Treatmen Plan</label></br>
                        <c-custom-lookup
                            obj-name='Treatment_Plan__c'
                            value-id={planId}
                            fields={customLookupTreatmentFields}
                            display-fields='Name'
                            read-only=true
                        >
                        </c-custom-lookup>
                    </div>
                    <div class="slds-col slds-size_1-of-2 slds-p-left_x-small" data-id='customlookupContact'> 
                        <label class="slds-form-element__label" for="form-element-01">Session Contact</label>
                        <c-custom-lookup
                            obj-name='Contact'
                            icon-name='standard:contact'
                            placeholder='Search For Contact...'
                            fields={customLookupContactFields}
                            display-fields={customLookupContactDisplayFields}
                            field-to-query='Name'
                            where-clause='Active__c = true'
                            label-name='Session Contact'
                            onlookup={customLookupEvent}
                            onexpandfield={handleCustomLookupExpandSearch}
                            element-id='customlookupContact'
                            initial-col-size='slds-col slds-size_1-of-2 slds-p-left_x-small'
                        >
                        </c-custom-lookup>
                    </div>
                    <div class="slds-col slds-size_1-of-2 slds-p-top_small"> 
                        <label class="slds-form-element__label" for="form-element-01">Animal</label>
                        <c-custom-lookup
                            obj-name='Animal__c'
                            value-id={animalId}
                            fields={customLookupTreatmentFields}
                            display-fields='Animal_Name_Id__c'
                            read-only=true
                        >
                        </c-custom-lookup>
                    </div>
                    <div class="slds-col slds-size_1-of-2 slds-p-left_x-small slds-p-top_small"> 
                        <lightning-input-field field-name="Session_Notes__c" required></lightning-input-field>
                    </div> 
                </div>
            </template>
            <template if:false={hasPlan}>
                Please create a Treatment Plan first.
            </template>
            <div  class="slds-align_absolute-center">
                <template if:true={showSpinner}>
                    <lightning-icon icon-name="utility:spinner" alternative-text="Connected" size="medium" title="large size">
                    </lightning-icon>
                </template>
                <template if:false={showSpinner}>
                    <lightning-button variant="neutral" label="Cancel" onclick={handleCancel}></lightning-button>
                    <template if:true={hasPlan}>
                        <lightning-button variant="brand" class="slds-var-m-left_x-small" label="Save" type="submit"></lightning-button>
                    </template>
                </template>
            </div>
        </lightning-record-edit-form>

    </div>
</template>